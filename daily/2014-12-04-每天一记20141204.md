---
layout: post
category : 日记
tags : [日记]
---
4号发布又没顾得上写，一大早补上。又是发布到11点，泪牛满面…… 这次又在guava面前栽了个跟头，咱就吃了这没文化的亏啊！！guava非常热衷于使用Precondition这个工具来检查，关键是在用Joiner来把一个HashMap转化为url参数类似的参数串时，entry很可能是会出现Null值的，这个时候Joiner会直接抛出来一个NullPoniterException Orz 懵懂无知的我就这样被摆上了案板剁了一到。关键是测试的时候还没发现…………上线之后发现有问题，还好老子精明，先发了一台验证效果，妥妥的回滚了。看来以后使用guava的任何组件，都要先把他们的源码翻一遍，挖地三尺看清楚里面的坑坑，不然真的是要疯。另外此处再一次表示对使用Precondition的厌恶。有时候参数有个Null啥的，空字符串啥的，很可能是个正常的业务，但是你直接抛个Runtime的Exception让业务流程走不下去，真的是要被坑死啊。但是Joiner这个地方这么用，我觉得倒是可以理解，因为对于entry为null的，joiner也不知道怎么给你转化成字符串，是用一个“null”好，还是一个空字符串呢？所以这里抛出一个runtimeException我就认了，谁让咱没文化呢？

今天遇到另外的一个坑是发现线上环境memcache的响应时间涨了……莫名其妙的突然从10ms涨到了20ms左右，但是看memcache的读写量并无太大变化，memcache本身也没特别多的挤出异常，只有cpu使用率高了一些，但是还是不到15%，不算高啊。百思不得其解，memcached之前分析不多，网上找了找，看到一个mctop挺高大上的，但是ruby的各种环境安装起来根本搞不定，对于号称易于使用的ruby我也就呵呵了。后来还是装了个memkeys看了下，也没发现太多异常之处……看来今天还是要另外想想办法监控。

刷围脖的时候看到R大转发了自己在Iteye上分享的一个文章，介绍说从JDK8开始oracle可能就要把主要精力集中在G1收集器上了，看来G1真心的要成为主流，以后要多研究研究了。
