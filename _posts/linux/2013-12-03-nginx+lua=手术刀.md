---
layout: post
category : nginx
tags : [nginx,openresty,lua]
---
之前听说过[@agentzh](https://github.com/agentzh)出品的openresty集成了很多有用的第三方module，特别是集成了lua相关的一系列东西，非常好用，这次终于有机会来尝试了。使用之后总体感觉就是一个字，“爽”，有一种甩开java的畅快感。

首先为了省事，没有安装nginx官方版本再自己一个个的去安装module，安装的是[openresty](http://openresty.org/)最新的稳定版。我们使用的到的模块，基本包括了[ngx_lua](http://wiki.nginx.org/HttpLuaModule)、[ngx_redis2](http://wiki.nginx.org/HttpRedis2Module)、cjson、[rds](http://github.com/agentzh/rds-json-nginx-module)这些模块。另外为了从nginx直接访问数据库，使用了[drizzle](http://wiki.nginx.org/HttpDrizzleModule)模块。

操作的流程概括起来讲，就是一方面通过ngx_lua模块抽取http post数据，进行一些简单的分析判断，将数据插入redis；另外一方面，当需要返回数据给客户端的时候，会调用redis2模块从多个redis DB中获取数据并拼接，最后转为json格式的字符串。

第一天code完了之后快下班的时候，才注意到原来开了eclipse一整天一分钟都没用过，而原来用java可能需要开发2、3天还得小心测试的code一天已经搞定并测试过了。并且nginx+lua的组合在淘宝已经经过了实战的检验，被证明是可以承受住相当的流量的。那么这样一个开发、调试迅速，系统消耗还低的组合，你是不是值得拥有？
